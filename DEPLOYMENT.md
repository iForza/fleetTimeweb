# üöÄ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º—É —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é Farm Monitor Pro

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è](#–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
2. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-—Å–µ—Ä–≤–µ—Ä–∞)
3. [–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è](#—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
4. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-ssl)
5. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–∏-–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ)
6. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
7. [–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫](#—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ-–Ω–µ–ø–æ–ª–∞–¥–æ–∫)

## üîß –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –°–µ—Ä–≤–µ—Ä–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- **–û–°**: Ubuntu 20.04 LTS –∏–ª–∏ –Ω–æ–≤–µ–µ
- **RAM**: –º–∏–Ω–∏–º—É–º 1 GB, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 2 GB
- **CPU**: 1 vCPU (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 2+)
- **–î–∏—Å–∫**: –º–∏–Ω–∏–º—É–º 10 GB —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
- **Node.js**: –≤–µ—Ä—Å–∏—è 18 LTS –∏–ª–∏ –Ω–æ–≤–µ–µ

### –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º
- [ ] –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É —á–µ—Ä–µ–∑ SSH
- [ ] –ü—Ä–∞–≤–∞ sudo –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- [ ] –î–æ–º–µ–Ω, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –Ω–∞ IP —Å–µ—Ä–≤–µ—Ä–∞ (–¥–ª—è SSL)
- [ ] –ê–∫—Ç—É–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –∫–æ–¥–∞ –≤ Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

## üõ†Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
wget https://raw.githubusercontent.com/iForza/fleetTimeweb/main/deploy-scripts/production-setup.sh
chmod +x production-setup.sh
./production-setup.sh
```

### 2. –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
```bash
sudo apt update && sudo apt upgrade -y
```

#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node.js 18 LTS
```bash
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs
```

#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
```bash
sudo apt install -y nginx pm2 ufw fail2ban git
sudo npm install -g pm2
```

#### –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```bash
sudo useradd --system --home /var/www/farm-monitor --shell /bin/bash www-data
sudo mkdir -p /var/www/farm-monitor/logs
sudo chown -R www-data:www-data /var/www/farm-monitor
```

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∞–π—Ä–≤–æ–ª–ª–∞
```bash
sudo ufw enable
sudo ufw allow ssh
sudo ufw allow 'Nginx Full'
```

## üì¶ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
```bash
cd /var/www/farm-monitor
sudo -u www-data git clone https://github.com/iForza/fleetTimeweb.git .
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞
```bash
sudo -u www-data cp env.example .env
sudo -u www-data nano .env
```

**–ü—Ä–∏–º–µ—Ä .env –¥–ª—è production:**
```env
NODE_ENV=production
PORT=3000

# –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
SESSION_SECRET=–≤–∞—à-–æ—á–µ–Ω—å-—Å–ª–æ–∂–Ω—ã–π-—Å–µ–∫—Ä–µ—Ç–Ω—ã–π-–∫–ª—é—á-–∏–∑–º–µ–Ω–∏—Ç–µ-–µ–≥–æ
JWT_SECRET=–≤–∞—à-jwt-—Å–µ–∫—Ä–µ—Ç–Ω—ã–π-–∫–ª—é—á-–∏–∑–º–µ–Ω–∏—Ç–µ-–µ–≥–æ

# Rate Limiting
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100

# CORS
ALLOWED_ORIGINS=https://–≤–∞—à-–¥–æ–º–µ–Ω.com

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
LOG_LEVEL=info
LOG_FILE_PATH=./logs/app.log

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
APP_NAME=Farm Monitor Pro
APP_VERSION=1.0.0
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
sudo -u www-data npm ci --only=production
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx

```bash
sudo nano /etc/nginx/sites-available/farm-monitor
```

```nginx
server {
    listen 80;
    server_name –≤–∞—à-–¥–æ–º–µ–Ω.com;
    
    # Security headers
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header Referrer-Policy "no-referrer-when-downgrade" always;
    add_header Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'" always;
    
    server_tokens off;
    
    # Gzip
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript application/javascript application/xml+rss;
    
    location / {
        proxy_pass http://127.0.0.1:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
    
    # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        try_files $uri @proxy;
    }
    
    location @proxy {
        proxy_pass http://127.0.0.1:3000;
    }
    
    client_max_body_size 10M;
}
```

```bash
sudo ln -s /etc/nginx/sites-available/farm-monitor /etc/nginx/sites-enabled/
sudo rm -f /etc/nginx/sites-enabled/default
sudo nginx -t
sudo systemctl reload nginx
```

### 5. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å PM2
```bash
sudo -u www-data pm2 start ecosystem.config.js --env production
sudo -u www-data pm2 save
```

### 6. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞
```bash
sudo env PATH=$PATH:/usr/bin /usr/lib/node_modules/pm2/bin/pm2 startup systemd -u www-data --hp /var/www/farm-monitor
```

## üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ SSL
```bash
chmod +x deploy-scripts/ssl-setup.sh
./deploy-scripts/ssl-setup.sh –≤–∞—à-–¥–æ–º–µ–Ω.com
```

### –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ SSL
```bash
sudo snap install --classic certbot
sudo ln -s /snap/bin/certbot /usr/bin/certbot
sudo certbot --nginx -d –≤–∞—à-–¥–æ–º–µ–Ω.com
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
```bash
# –°—Ç–∞—Ç—É—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
sudo -u www-data pm2 status

# –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
sudo -u www-data pm2 logs

# Health check
curl http://localhost:3000/health
```

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã PM2
```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–µ–∑ –¥–∞—É–Ω—Ç–∞–π–º–∞
sudo -u www-data pm2 reload ecosystem.config.js --env production

# –ü—Ä–æ—Å–º–æ—Ç—Ä –º–µ—Ç—Ä–∏–∫
sudo -u www-data pm2 monit

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
sudo -u www-data pm2 stop farm-monitor-pro

# –£–¥–∞–ª–µ–Ω–∏–µ
sudo -u www-data pm2 delete farm-monitor-pro
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```bash
cd /var/www/farm-monitor
sudo -u www-data git pull origin main
sudo -u www-data npm ci --only=production
sudo -u www-data pm2 reload ecosystem.config.js --env production
```

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
npm audit
npm audit fix
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Fail2Ban
```bash
sudo systemctl status fail2ban
sudo fail2ban-client status
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤
```bash
# –õ–æ–≥–∏ Nginx
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log

# –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
sudo tail -f /var/www/farm-monitor/logs/combined.log

# –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏
sudo journalctl -u farm-monitor -f
```

### –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –∑–∞–¥–∞—á–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
```bash
# –î–æ–±–∞–≤—å—Ç–µ –≤ crontab (sudo crontab -e):

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∫–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é
0 2 * * 0 apt update && apt upgrade -y

# –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
0 3 1,15 * * certbot renew --quiet

# –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤ PM2
0 1 * * * pm2 flush

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
0 6 * * * df -h | mail -s "Disk Usage Report" admin@–≤–∞—à-–¥–æ–º–µ–Ω.com
```

## üîç –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
sudo -u www-data pm2 logs

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
sudo -u www-data node -c server.js

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—Ç—ã
sudo netstat -tulpn | grep 3000
```

### Nginx –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 502 Bad Gateway
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å Node.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
sudo -u www-data pm2 status

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Nginx
sudo tail -f /var/log/nginx/error.log

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
sudo -u www-data pm2 restart farm-monitor-pro
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å SSL
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
sudo certbot certificates

# –û–±–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
sudo certbot renew

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Nginx
sudo nginx -t
```

### –í—ã—Å–æ–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ CPU/–ø–∞–º—è—Ç–∏
```bash
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤
sudo -u www-data pm2 monit

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
top
htop

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
sudo -u www-data pm2 reload ecosystem.config.js --env production
```

### –ö–æ–Ω—Ç–∞–∫—Ç—ã
- üìß Email: support@fleetmonitor.ru
- üêõ Issues: [GitHub Issues](https://github.com/iForza/fleetTimeweb/issues)
- üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: [GitHub Wiki](https://github.com/iForza/fleetTimeweb/wiki)

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

- [ ] –°–µ—Ä–≤–µ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –æ–±–Ω–æ–≤–ª–µ–Ω
- [ ] Node.js 18+ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] PM2 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≥–ª–æ–±–∞–ª—å–Ω–æ
- [ ] Nginx –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –§–∞–π—Ä–≤–æ–ª–ª UFW –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
- [ ] Fail2Ban –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ
- [ ] .env —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- [ ] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ —á–µ—Ä–µ–∑ PM2
- [ ] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ PM2 –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –õ–æ–≥—Ä–æ—Ç–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- [ ] –ë—ç–∫–∞–ø—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

**–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! üéâ –í–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Farm Monitor Pro –≥–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ –≤ production —Å—Ä–µ–¥–µ!** 